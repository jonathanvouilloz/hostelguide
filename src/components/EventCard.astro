---
/**
 * EventCard - Event listing with timeline design
 * Redesigned for BLACK theme
 */
import type { HostelEvent } from '../lib/types';
import { getWhatsAppUrl } from '../lib/deeplinks';
import Badge from './ui/Badge.astro';

interface Props {
  event: HostelEvent;
  showTimelineNode?: boolean;
  isFirst?: boolean;
}

const { event, showTimelineNode = false, isFirst = false } = Astro.props;

// Build CTA URL
function getCtaUrl(): string | null {
  if (!event.cta) return null;

  if (event.cta.type === 'whatsapp') {
    return getWhatsAppUrl(event.cta.url, event.cta.message);
  }
  return event.cta.url;
}

const ctaUrl = getCtaUrl();
---

<article class="event-card relative flex gap-4">
  <!-- Timeline Node -->
  {showTimelineNode && (
    <div class="flex flex-col items-center pt-1">
      <div class:list={[
        'flex size-11 shrink-0 items-center justify-center rounded-full border-2',
        isFirst
          ? 'bg-[--color-primary] border-[--color-primary] text-[--color-bg]'
          : 'bg-[--color-surface] border-[--color-border-light] text-[--color-primary]'
      ]}>
        <span class="material-symbols-outlined text-[20px]">celebration</span>
      </div>
    </div>
  )}

  <!-- Event Content -->
  <div class="flex-1 card overflow-hidden">
    <!-- Time Badge -->
    <div class="flex items-center justify-between p-3 border-b border-[--color-border]">
      <div class="flex items-center gap-2">
        <span class="material-symbols-outlined text-[--color-primary] text-[18px]">schedule</span>
        <span class="text-sm font-bold text-[--color-text]">
          {event.startTime} - {event.endTime}
        </span>
      </div>
      {event.price && (
        <Badge variant="success">{event.price}</Badge>
      )}
    </div>

    <!-- Event Details -->
    <div class="p-4 space-y-3">
      <div>
        <h3 class="text-lg font-bold text-[--color-text] leading-tight">{event.title}</h3>
        <p class="text-sm text-[--color-text-secondary] mt-1 line-clamp-2">{event.description}</p>
      </div>

      <!-- Location -->
      <div class="flex items-center gap-2 text-sm text-[--color-text-secondary]">
        <span class="material-symbols-outlined text-[16px]">location_on</span>
        <span>{event.location}</span>
      </div>

      <!-- CTA Button -->
      {ctaUrl && event.cta && (
        <a
          href={ctaUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center justify-center gap-2 w-full py-3 rounded-xl bg-[--color-primary] text-[--color-bg] font-bold text-sm mt-2 hover:bg-[--color-primary-dark] transition-colors touch-target"
        >
          <span class="material-symbols-outlined text-[18px]">
            {event.cta.type === 'whatsapp' ? 'chat' : 'arrow_forward'}
          </span>
          {event.cta.label}
        </a>
      )}
    </div>
  </div>
</article>
